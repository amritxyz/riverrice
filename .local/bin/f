#!/bin/sh

if [ -n "$TMUX" ]; then
	CMD="fzf-tmux --height 40%"
else
	CMD="fzf --height 40%"
fi

TARGET=$(find . -type f -o -type d 2>/dev/null | sh -c "$CMD") || exit 1

if [ -d "$TARGET" ]; then
	cd "$TARGET" || exit 1
	exec "${SHELL:-/bin/sh}"
fi

MIME=$(file --mime-type -b "$TARGET")

case "$MIME" in
	image/*)
		exec imv "$TARGET"
		;;

	video/*|audio/*)
		exec mpv --force-window "$TARGET"
		;;

	application/pdf)
		exec zathura "$TARGET"
		;;

	image/vnd.djvu|image/x-djvu)
		exec zathura "$TARGET"
		;;

	application/vnd.openxmlformats-officedocument.*|\
	application/vnd.ms-*|\
	application/msword|\
	application/vnd.oasis.opendocument.*|\
	text/csv)
		exec libreoffice "$TARGET"
		;;

	application/x-bittorrent)
		exec qbittorrent "$TARGET"
		;;

	text/*|\
	application/json|\
	application/javascript|\
	inode/*|\
	application/*-ini)
		exec nvim "$TARGET"
		;;

	# Fallback
	*)
		exec xdg-open "$TARGET"
		;;
esac
